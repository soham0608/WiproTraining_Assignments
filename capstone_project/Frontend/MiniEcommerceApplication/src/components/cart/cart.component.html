<app-header></app-header>

<div class="container cart-container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ðŸ›’ My Cart</h2>
    <button
      class="btn btn-outline-primary rounded-pill"
      (click)="continueShopping()"
    >
      Continue Shopping
    </button>
  </div>

  @if (isLoading) {
  <div class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 fw-semibold">Loading your cart...</p>
  </div>
  } @else if (cartItems.length === 0) {
  <div class="text-center empty-cart py-5">
    <p class="fs-5 text-muted">Your cart is empty</p>
    <button
      class="btn btn-primary mt-3 rounded-pill"
      (click)="continueShopping()"
    >
      Start Shopping
    </button>
  </div>
  } @else {
  <div class="row">
    <div class="col-lg-8">
      <div class="cart-items">
        @for (item of cartItems; track item.productId) {
        <div class="card cart-item shadow-sm border-0 mb-3">
          <div class="card-body d-flex align-items-center">
            @if (item.product) {
            <img
              [src]="item.product.imageURL || 'assets/default-product.png'"
              alt="{{ item.product.prodName }}"
              class="product-image me-3"
            />

            <div class="item-details flex-grow-1">
              <h5 class="mb-1">{{ item.product.prodName }}</h5>
              <p class="price text-primary fw-bold mb-1">
                {{ item.product.price | currency : "INR" }}
              </p>
              <p class="category text-muted small">
                {{ item.product.prodCat }}
              </p>
            </div>

            <div class="quantity-controls d-flex align-items-center mx-3">
              <button
                class="btn btn-sm btn-outline-secondary"
                (click)="updateQuantity(item.productId, item.quantity - 1)"
              >
                -
              </button>
              <span class="mx-2 fw-bold">{{ item.quantity }}</span>
              <button
                class="btn btn-sm btn-outline-secondary"
                (click)="updateQuantity(item.productId, item.quantity + 1)"
              >
                +
              </button>
            </div>

            <div class="item-total fw-bold text-success me-3">
              {{ item.product.price * item.quantity | currency : "INR" }}
            </div>

            <button
              class="btn btn-sm btn-danger rounded-circle"
              (click)="removeItem(item.productId)"
            >
              Ã—
            </button>
            } @else {
            <p class="text-muted">Loading product {{ item.productId }}...</p>
            }
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Cart Summary -->
    <div class="col-lg-4">
      <div class="cart-summary card shadow-sm p-3">
        <h4 class="fw-bold mb-3">Order Summary</h4>
        <p class="fs-5">
          Total:
          <span class="fw-bold text-success">{{
            totalPrice | currency : "INR"
          }}</span>
        </p>
        <button
          class="btn btn-success w-100 py-2 rounded-pill"
          (click)="proceedToCheckout()"
        >
          Checkout
        </button>
      </div>
    </div>
  </div>
  }
</div>
