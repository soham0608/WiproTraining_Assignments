<app-header></app-header>

<div class="container order-history-container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ðŸ“¦ My Orders</h2>
    <button (click)="continueShopping()" class="btn btn-primary rounded-pill">
      Continue Shopping
    </button>
  </div>

  <!-- Alerts -->
  <div *ngIf="successMessage" class="alert alert-success shadow-sm">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger shadow-sm">
    {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 fw-semibold">Loading orders...</p>
  </div>

  <!-- Empty Orders -->
  <div *ngIf="!isLoading && orders.length === 0" class="text-center py-5">
    <p class="fs-5 text-muted">You haven't placed any orders yet.</p>
    <button
      (click)="continueShopping()"
      class="btn btn-outline-primary rounded-pill mt-3"
    >
      Start Shopping
    </button>
  </div>

  <!-- Orders Table -->
  <div *ngIf="!isLoading && orders.length > 0" class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle orders-table mb-0">
          <thead class="table-light">
            <tr>
              <th>Order #</th>
              <th>Date</th>
              <th>Status</th>
              <th>Total Amount</th>
              <th>Items</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders">
              <td class="fw-bold">#{{ order.orderId }}</td>
              <td>{{ order.orderDate | date : "mediumDate" }}</td>
              <td>
                <span
                  class="badge px-3 py-2"
                  [ngClass]="{
                    'bg-warning text-dark':
                      order.orderStatus.toLowerCase() === 'pending',
                    'bg-success':
                      order.orderStatus.toLowerCase() === 'completed',
                    'bg-danger': order.orderStatus.toLowerCase() === 'cancelled'
                  }"
                >
                  {{ order.orderStatus }}
                </span>
              </td>
              <td class="fw-semibold text-success">
                {{ order.totalAmount | currency : "INR" }}
              </td>
              <td>
                <ul class="list-unstyled mb-0 small">
                  <li *ngFor="let item of getOrderItems(order.orderId!)">
                    {{ item.productName }}
                    <span class="text-muted">(x{{ item.quantity }})</span> -
                    <span class="fw-semibold">{{
                      item.total | currency : "INR"
                    }}</span>
                  </li>
                </ul>
              </td>
              <td>
                <button
                  *ngIf="canCancelOrder(order)"
                  (click)="cancelOrder(order.orderId!)"
                  class="btn btn-sm btn-warning rounded-pill"
                >
                  Cancel
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
